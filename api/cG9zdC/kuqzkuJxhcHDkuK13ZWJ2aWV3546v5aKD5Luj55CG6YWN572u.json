{"title":"京东app中webview环境代理配置","date":"2018-01-25T16:00:00.000Z","author":"Mickey","thumbnail":"images/others/jd.jpg","excerpt":"","slug":"京东app中webview环境代理配置","comments":true,"tags":["forJD"],"categories":["技术博客"],"updated":"2018-07-03T07:30:44.999Z","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>本文是一篇配置教程。适用于在京东app中的webview环境中测试待上线的H5应用。<strong>Powered by 冯旭东(fengxudong1)</strong>。</p>\n<p>需要用到的软件物料地址如下：</p>\n<ol>\n<li><a href=\"https://www.charlesproxy.com/latest-release/download.do\" target=\"_blank\" rel=\"noopener\">charles 4.2.1</a> </li>\n<li><a href=\"https://www.zzzmode.com/mytools/charles/\" target=\"_blank\" rel=\"noopener\">charles科学使用工具</a></li>\n<li><a href=\"http://wifi.360.cn/easy/pc\" target=\"_blank\" rel=\"noopener\">360免费WIFI</a></li>\n</ol>\n<h2 id=\"软件准备\"><a href=\"#软件准备\" class=\"headerlink\" title=\"软件准备\"></a>软件准备</h2><p>按照上述，下载Charles，并进行科学配置。如若PC或Mac及移动设备已处于同一wifi环境，可忽略安装360免费WIFI。</p>\n<h2 id=\"软件及环境配置\"><a href=\"#软件及环境配置\" class=\"headerlink\" title=\"软件及环境配置\"></a>软件及环境配置</h2><p>如果你还对Charles不是很熟悉，这里提供一篇完备详尽的<a href=\"http://blog.devtang.com/2015/11/14/charles-introduction/\" target=\"_blank\" rel=\"noopener\">Charles 从入门到精通</a>，在时间充裕的情况下请参考查阅。下面对主要配置及接入京东app的调试步骤做以说明。</p>\n<h3 id=\"Charles配置\"><a href=\"#Charles配置\" class=\"headerlink\" title=\"Charles配置\"></a>Charles配置</h3><p>正常安装Charles后便可截获本机Http封包，如若需要过滤请求方便查看，请移步<a href=\"http://blog.devtang.com/2015/11/14/charles-introduction/\" target=\"_blank\" rel=\"noopener\">Charles 从入门到精通</a>查看。为截获移动设备封包，在 Charles 的菜单栏上选择 <code>“Proxy”-&gt;”Proxy Settings”</code>，填入代理端口 8888，并且勾上 <code>“Enable transparent HTTP proxying”</code> 就完成了在 Charles 上的设置。</p>\n<center><img src=\"images/tech/JDapp_proxy_1.PNG\" alt=\"捕获.PNG-26.5kB\"></center>\n\n<h3 id=\"配置移动设备\"><a href=\"#配置移动设备\" class=\"headerlink\" title=\"配置移动设备\"></a>配置移动设备</h3><p>此处以iPhone为例做介绍。首先我们需要获取 Charles 运行所在电脑的 IP 地址，Charles 的顶部菜单的 <code>“Help”-&gt;”Local IP Address”</code>，即可在弹出的对话框中看到 IP 地址，如下图所示：</p>\n<center><img src=\"images/tech/JDapp_proxy_2.PNG\" alt=\"捕获.PNG-40.7kB\"></center>\n\n<p> 在 iPhone 的 “ 设置 “-&gt;” 无线局域网 “ 中，可以看到当前连接的 wifi 名，通过点击右边的详情键，可以看到当前连接上的 wifi 的详细信息，包括 IP 地址，子网掩码等信息。在其最底部有「HTTP 代理」一项，我们将其切换成手动，然后填上 Charles 运行所在的电脑的 IP，以及端口号 8888。</p>\n<p> 设置好之后，我们打开 iPhone 上的任意需要网络通讯的程序，就可以看到 Charles 弹出 iPhone 请求连接的确认菜单，点击 “Allow” 即可完成设置。</p>\n<h3 id=\"配置截取-Https\"><a href=\"#配置截取-Https\" class=\"headerlink\" title=\"配置截取 Https\"></a>配置截取 Https</h3><p>点击 Charles 的顶部菜单，选择 <code>“Help” -&gt; “SSL Proxying” -&gt; “Install Charles Root Certificate”</code>，顺序执行安装。</p>\n<p>如果我们需要在 iOS 或 Android 机器上截取 Https 协议的通讯内容，还需要在手机上安装相应的证书。点击 Charles 的顶部菜单，选择 <code>“Help” -&gt; “SSL Proxying” -&gt; “Install Charles Root Certificate on a Mobile Device or Remote Browser”</code>，然后就可以看到 Charles 弹出的简单的安装教程。如下图所示：</p>\n<center><img src=\"images/tech/JDapp_proxy_3.PNG\" alt=\"捕获.PNG-27.4kB\"></center>\n\n<p>如图显示，浏览器访问<code>chls.pro/ssl</code>，顺序执行安装。<strong>注意此时移动设备一定已安装前述步骤做过代理配置</strong>。</p>\n<h3 id=\"针对京东app的配置\"><a href=\"#针对京东app的配置\" class=\"headerlink\" title=\"针对京东app的配置\"></a>针对京东app的配置</h3><p>针对app的配置，总的思路是截获<code>http://api.m.jd.com/client.action?functionId=appCenter</code>的封包，然后利用Charles的Map或Rewrite功能改写响应报文以展示想要配置的icon。</p>\n<center><img src=\"images/tech/JDapp_proxy_4.PNG\" alt=\"捕获.PNG-84.2kB\"></center>\n\n<ul>\n<li>首先在app设置中清空缓存并退出，准备在Charles中截获封包；</li>\n<li>重新进入app，点击app中的<strong>全部icon</strong>，找到下图中的1，右键点击<code>SSL Proxying：Enable</code>;</li>\n<li>清空app缓存并退出，准备重新截获封包；</li>\n<li>再次进入app，点击app中的<strong>全部icon</strong>，找到如下图中2所示的前置图标开头的<code>http</code>请求；</li>\n<li>点击下图中3，复制一份响应数据4，并保存到本地文件，后缀为<code>.json</code>；</li>\n<li><p>修改其中一项的name和url；</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &#123;</span><br><span class=\"line\">\t<span class=\"attr\">\"id\"</span>: <span class=\"number\">126</span>,</span><br><span class=\"line\">\t<span class=\"attr\">\"icon\"</span>: <span class=\"string\">\"https://m.360buyimg.com/mobilecms/s80x80_jfs/t5830/118/179491490/8188/42c7ec47/591dab29N24f970a9.png\"</span>,</span><br><span class=\"line\">\t<span class=\"attr\">\"slogan\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">\t<span class=\"attr\">\"order\"</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">\t\"name\": \"酒店试用\",// 已改为自定义</span><br><span class=\"line\">\t\"appCode\": \"jdsy\",</span><br><span class=\"line\">\t\"jump\": &#123;</span><br><span class=\"line\">\t\t\"des\": \"m\",</span><br><span class=\"line\">\t\t\"params\": &#123;</span><br><span class=\"line\">\t\t\t\"needLogin\": \"0\",</span><br><span class=\"line\">\t\t\t\"url\": \"http://trip.hotel.m.jd.com/\"// 已改为自定义</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t\"srv\": \"4_京东试用_购京东_126_jdsy_-100\"</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<center><img src=\"images/tech/JDapp_proxy_5.PNG\" alt=\"捕获.PNG-249.5kB\"></center>\n\n<ul>\n<li><p>右击上图3，选择<code>Map Local</code>，关联上步中的json文件，如下图；</p>\n<center><img src=\"images/tech/JDapp_proxy_6.PNG\" alt=\"捕获.PNG-48.3kB\"></center></li>\n<li>配置好后，再次清空app缓存并退出；</li>\n<li>再次重新进入时，点击app中的全部icon，便可看到刚才配置的icon，点击跳转访问H5应用；</li>\n</ul>\n<center><img src=\"images/tech/JDapp_proxy_7.PNG\" alt=\"捕获.PNG-186.2kB\"></center>\n\n<p>如若有任何问题，请咚咚联系以获取支持，谢谢。</p>\n","prev":{"title":"从Web到未来","slug":"从Web到未来"},"next":{"title":"商城“智能”导航栏实践","slug":"商城“智能”导航栏实践"},"link":"http://mickeywang.com/post/京东app中webview环境代理配置"}